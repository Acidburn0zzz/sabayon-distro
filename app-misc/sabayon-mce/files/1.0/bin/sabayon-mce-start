#!/bin/sh

# setup
myxinitrc="/usr/bin/sabayon-mce-session"
myuser="sabayonmce"
mcepid="/var/sabayonmce/.mcepid"

# Kill previous instance running since
# /etc/init.d/xdm does not support PIDFILE for
# custom DISPLAYMANAGER
[[ -f "$mcepid" ]] && kill $(cat $mcepid) &> /dev/null

# make sure all the instances are killed
killall X &> /dev/null
# wait for process to be killed
[[ "${?}" = "0" ]] && sleep 3

# spawn!
su - ${myuser} -c "source /etc/profile && /usr/bin/sabayon-mce-startx ${myxinitrc} &> /dev/null" &
