#!/sbin/runscript
# Copyright 2009 Sabayon Linux

depend() {
	after mtab
	before xdm
	# In this way autologin settings are overwritten
	after sabayonlive
}

start() {

	source /sbin/sabayon-functions.sh
	sabayonmce_avail=$(cat /proc/cmdline | grep sabayonmce)
	is_live=$(cat /proc/cmdline | grep cdroot)

	if [ -n "$sabayonmce_avail" ]; then
		ebegin "Sabayon Media Center mode enabled"

		# setup default .dmrc
		echo "[Desktop]" > /var/sabayonmce/.dmrc
		echo "Session=sabayon-mce" >> /var/sabayonmce/.dmrc
		chown sabayonmce /var/sabayonmce/.dmrc

		SABAYON_USER="sabayonmce"
		sabayon_setup_autologin
	elif [ -z "$is_live" ]; then
		ebegin "Sabayon Media Center mode disabled"
		sabayon_disable_autologin
	fi

	eend 0

}

