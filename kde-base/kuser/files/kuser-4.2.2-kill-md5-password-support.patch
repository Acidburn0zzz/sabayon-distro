diff -Nurp kuser-4.2.2.orig/kuser/ku_filessettings.ui kuser-4.2.2/kuser/ku_filessettings.ui
--- kuser-4.2.2.orig/kuser/ku_filessettings.ui	2008-01-05 00:58:29.000000000 +0100
+++ kuser-4.2.2/kuser/ku_filessettings.ui	2009-05-03 09:14:08.637935801 +0200
@@ -1,10 +1,8 @@
-<ui version="4.0" >
- <author></author>
- <comment></comment>
- <exportmacro></exportmacro>
+<?xml version="1.0" encoding="UTF-8"?>
+<ui version="4.0">
  <class>KU_FilesSettings</class>
- <widget class="QWidget" name="KU_FilesSettings" >
-  <property name="geometry" >
+ <widget class="QWidget" name="KU_FilesSettings">
+  <property name="geometry">
    <rect>
     <x>0</x>
     <y>0</y>
@@ -12,101 +10,105 @@
     <height>367</height>
    </rect>
   </property>
-  <property name="sizePolicy" >
-   <sizepolicy>
-    <hsizetype>5</hsizetype>
-    <vsizetype>5</vsizetype>
+  <property name="sizePolicy">
+   <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
     <horstretch>0</horstretch>
     <verstretch>0</verstretch>
    </sizepolicy>
   </property>
-  <layout class="QVBoxLayout" >
-   <property name="margin" >
-    <number>9</number>
-   </property>
-   <property name="spacing" >
+  <layout class="QVBoxLayout">
+   <property name="spacing">
     <number>6</number>
    </property>
+   <property name="margin">
+    <number>9</number>
+   </property>
    <item>
-    <widget class="QGroupBox" name="groupBox" >
-     <property name="title" >
+    <widget class="QGroupBox" name="groupBox">
+     <property name="title">
       <string>User/group database locations</string>
      </property>
-     <layout class="QGridLayout" >
-      <property name="margin" >
+     <layout class="QGridLayout">
+      <property name="margin">
        <number>9</number>
       </property>
-      <property name="spacing" >
+      <property name="spacing">
        <number>6</number>
       </property>
-      <item row="4" column="0" colspan="2" >
-       <widget class="QCheckBox" name="kcfg_md5shadow" >
-        <property name="text" >
+      <item row="4" column="0" colspan="2">
+       <widget class="QCheckBox" name="kcfg_md5shadow">
+        <property name="enabled">
+         <bool>false</bool>
+        </property>
+        <property name="text">
          <string>MD5 shadow passwords</string>
         </property>
+        <property name="checkable">
+         <bool>false</bool>
+        </property>
        </widget>
       </item>
-      <item row="3" column="1" >
-       <widget class="KLineEdit" name="kcfg_gshadowsrc" />
+      <item row="3" column="1">
+       <widget class="KLineEdit" name="kcfg_gshadowsrc" native="true"/>
       </item>
-      <item row="3" column="0" >
-       <widget class="QLabel" name="textLabel6_3" >
-        <property name="text" >
+      <item row="3" column="0">
+       <widget class="QLabel" name="textLabel6_3">
+        <property name="text">
          <string>Shadow group file:</string>
         </property>
-        <property name="buddy" >
+        <property name="buddy">
          <cstring>kcfg_gshadowsrc</cstring>
         </property>
        </widget>
       </item>
-      <item row="2" column="1" >
-       <widget class="KLineEdit" name="kcfg_shadowsrc" />
+      <item row="2" column="1">
+       <widget class="KLineEdit" name="kcfg_shadowsrc" native="true"/>
       </item>
-      <item row="2" column="0" >
-       <widget class="QLabel" name="textLabel5_3" >
-        <property name="text" >
+      <item row="2" column="0">
+       <widget class="QLabel" name="textLabel5_3">
+        <property name="text">
          <string>Shadow password file:</string>
         </property>
-        <property name="buddy" >
+        <property name="buddy">
          <cstring>kcfg_shadowsrc</cstring>
         </property>
        </widget>
       </item>
-      <item row="1" column="1" >
-       <widget class="KLineEdit" name="kcfg_groupsrc" />
+      <item row="1" column="1">
+       <widget class="KLineEdit" name="kcfg_groupsrc" native="true"/>
       </item>
-      <item row="1" column="0" >
-       <widget class="QLabel" name="textLabel4_3" >
-        <property name="text" >
+      <item row="1" column="0">
+       <widget class="QLabel" name="textLabel4_3">
+        <property name="text">
          <string>Group file:</string>
         </property>
-        <property name="buddy" >
+        <property name="buddy">
          <cstring>kcfg_groupsrc</cstring>
         </property>
        </widget>
       </item>
-      <item row="0" column="0" >
-       <widget class="QLabel" name="textLabel3_3" >
-        <property name="text" >
+      <item row="0" column="0">
+       <widget class="QLabel" name="textLabel3_3">
+        <property name="text">
          <string>Password file:</string>
         </property>
-        <property name="buddy" >
+        <property name="buddy">
          <cstring>kcfg_passwdsrc</cstring>
         </property>
        </widget>
       </item>
-      <item row="0" column="1" >
-       <widget class="KLineEdit" name="kcfg_passwdsrc" />
+      <item row="0" column="1">
+       <widget class="KLineEdit" name="kcfg_passwdsrc" native="true"/>
       </item>
      </layout>
     </widget>
    </item>
    <item>
     <spacer>
-     <property name="orientation" >
+     <property name="orientation">
       <enum>Qt::Vertical</enum>
      </property>
-     <property name="sizeHint" >
+     <property name="sizeHint" stdset="0">
       <size>
        <width>20</width>
        <height>40</height>
@@ -116,15 +118,13 @@
    </item>
   </layout>
  </widget>
- <layoutdefault spacing="6" margin="11" />
+ <layoutdefault spacing="6" margin="11"/>
  <pixmapfunction>qPixmapFromMimeSource</pixmapfunction>
  <customwidgets>
   <customwidget>
    <class>KLineEdit</class>
    <extends></extends>
    <header>klineedit.h</header>
-   <container>0</container>
-   <pixmap></pixmap>
   </customwidget>
  </customwidgets>
  <tabstops>
diff -Nurp kuser-4.2.2.orig/kuser/kuser.kcfg kuser-4.2.2/kuser/kuser.kcfg
--- kuser-4.2.2.orig/kuser/kuser.kcfg	2008-01-05 00:58:29.000000000 +0100
+++ kuser-4.2.2/kuser/kuser.kcfg	2009-05-03 09:16:26.495691105 +0200
@@ -112,6 +112,7 @@
     <entry name="md5shadow" type="Bool">
       <label>MD5 Shadow passwords</label>
       <whatsthis>Check this if you want the passwords in the shadow file MD5 hashed. Leave this unchecked if DES encryption should be used.</whatsthis>
+      <default>false</default>
     </entry>
     <entry name="shadowsrc" type="String">
       <label>Shadow password file</label>
diff -Nurp kuser-4.2.2.orig/kuser/ku_userfiles.cpp kuser-4.2.2/kuser/ku_userfiles.cpp
--- kuser-4.2.2.orig/kuser/ku_userfiles.cpp	2008-12-04 09:35:50.000000000 +0100
+++ kuser-4.2.2/kuser/ku_userfiles.cpp	2009-05-03 09:19:19.040700070 +0200
@@ -453,7 +453,7 @@ bool KU_UserFiles::savepwd()
 void KU_UserFiles::createPassword( KU_User &user, const QString &password )
 {
   if ( caps & Cap_Shadow ) {
-    user.setSPwd( encryptPass( password, mCfg->md5shadow() ) );
+    user.setSPwd( encryptPass( password, false /* md5 always false, was: mCfg->md5shadow() */ ) );
     user.setPwd( QString::fromLatin1("x") );
   } else
     user.setPwd( encryptPass( password, false ) );
