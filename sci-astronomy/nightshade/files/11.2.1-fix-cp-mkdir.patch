Don't call system() with cp or mkdir.
SÅ‚awomir Nizio <slawomir.nizio at sabayon.org>
diff -Naur nightshade-11.2.1.orig/src/app_settings.cpp nightshade-11.2.1/src/app_settings.cpp
--- nightshade-11.2.1.orig/src/app_settings.cpp	2011-02-14 20:18:50.000000000 +0100
+++ nightshade-11.2.1/src/app_settings.cpp	2011-06-29 16:46:34.339000032 +0200
@@ -113,7 +113,7 @@
 
 			// The config file is too old to try an importation
 			printf("The current config file is from a version too old for parameters to be imported (%s).\nIt will be replaced by the default config file.\n", version.empty() ? "<0.6.0" : version.c_str());
-			system( (string("cp -f ") + m_dataRoot + "/data/default_config.ini " + getConfigFile()).c_str() );
+			copy_file(m_dataRoot + "/data/default_config.ini", getConfigFile(), true);
 			conf->load(m_configDir + "config.ini");  // Read new config!
 		} else {
 
diff -Naur nightshade-11.2.1.orig/src/main.cpp nightshade-11.2.1/src/main.cpp
--- nightshade-11.2.1.orig/src/main.cpp	2011-02-14 20:18:50.000000000 +0100
+++ nightshade-11.2.1/src/main.cpp	2011-06-29 16:44:13.265000050 +0200
@@ -38,6 +38,7 @@
 
 #ifndef WIN32
 #include <X11/Xlib.h>
+#include <sys/stat.h>
 #endif
 
 #ifdef WIN32
@@ -148,7 +149,7 @@
 		cerr << "Creating in " << CDIR << ".\n";
 		firstRun = true;
 		system( (string("mkdir \"") + CDIR + "\"").c_str() );
-		system( (string("copy \"") + DATA_ROOT + "\\data\\default_config.ini\" " + "\"" + CDIR + "config.ini\"").c_str() );
+		copy_file(DATA_ROOT + "\\data\\default_config.ini", CDIR + "config.ini", true);
 	}
 #else
 
@@ -201,7 +202,9 @@
 		} else {
 			// Maybe the directory is not created so try to create it
 			printf("Try to create directory %s\n",CDIR.c_str());
-			::system(string("mkdir " + CDIR).c_str());
+			if (mkdir(CDIR.c_str(), 0777) < 0) {
+				cerr << "Couldn't create directory " << CDIR << "." << endl;
+			}
 
 			if ((tempFile = fopen((CDIR + "config.ini").c_str(),"w"))) {
 				fclose(tempFile);
@@ -214,7 +217,7 @@
 		}
 
 		// First launch for that user : set default options by copying the default files
-		::system( (string("cp ") + DATA_ROOT + "/data/default_config.ini " + CDIR + "config.ini").c_str() );
+		copy_file(DATA_ROOT + "/data/default_config.ini", CDIR + "config.ini", true);
 	}
 #endif	// Unix system
 
diff -Naur nightshade-11.2.1.orig/src/utility.cpp nightshade-11.2.1/src/utility.cpp
--- nightshade-11.2.1.orig/src/utility.cpp	2011-02-14 20:18:50.000000000 +0100
+++ nightshade-11.2.1/src/utility.cpp	2011-06-29 16:35:45.102000102 +0200
@@ -864,4 +864,26 @@
 		return strftime(s, max, fmt, tm);
 }
 
+// A very basic function to copy file.
+// Note: 'to' must contain file name.
+// Returns 0 on success, otherwise a non-zero value.
+int copy_file(const std::string src, const std::string to, bool verbose) {
+	std::ifstream ifs(src.c_str(), std::ios::binary);
+	if (!ifs.is_open()) {
+		if (verbose)
+			std::cerr << "Cannot open " << src << std::endl;
+		return -1;
+	}
+	std::ofstream ofs(to.c_str(), std::ios::binary);
+	if (!ofs.is_open()) {
+		if (verbose)
+			std::cerr << "Cannot open " << to << std::endl;
+		ifs.close();
+		return -2;
+	}
 
+	ofs << ifs.rdbuf();
+	ifs.close();
+	ofs.close();
+	return 0;
+}
diff -Naur nightshade-11.2.1.orig/src/utility.h nightshade-11.2.1/src/utility.h
--- nightshade-11.2.1.orig/src/utility.h	2010-10-21 18:17:14.000000000 +0200
+++ nightshade-11.2.1/src/utility.h	2011-06-29 16:32:59.518000034 +0200
@@ -26,6 +26,7 @@
 #ifndef _S_UTILITY_H_
 #define _S_UTILITY_H_
 
+#include <fstream>
 #include <iostream>
 #include <sstream>
 #include <string>
@@ -184,5 +185,6 @@
 
 int getNextPowerOf2(int i);
 
+int copy_file(const std::string src, const std::string to, bool verbose);
 
 #endif
